# SquareLine UI Merge Checklist

Step-by-step guide to integrate SquareLine Studio UI into esp32_p4_nfc_espidf firmware

---

## Prerequisites

- [ ] Both projects backed up
- [ ] ESP-IDF v5.5.1 environment working
- [ ] SquareLine Studio UI exported to `esp32_p4_lvgl_test/ui/`
- [ ] Familiar with existing `esp32_p4_nfc_espidf` codebase

---

## Phase 1: Backup & Preparation (5 minutes)

### 1.1 Create Backups
```bash
cd /Users/ryangoff/Herd/Attend/storage/app/templates

# Backup the NFC firmware
tar -czf esp32_p4_nfc_espidf_backup_$(date +%Y%m%d_%H%M%S).tar.gz esp32_p4_nfc_espidf/

# Backup the UI test project
tar -czf esp32_p4_lvgl_test_backup_$(date +%Y%m%d_%H%M%S).tar.gz esp32_p4_lvgl_test/
```

- [ ] Backups created successfully
- [ ] Verify backup files exist (`ls -lh *.tar.gz`)

### 1.2 Enable API Client
```bash
cd esp32_p4_nfc_espidf
```

Edit `main/features.h`:
```c
// Change from:
#define API_ENABLED 0

// To:
#define API_ENABLED 1
```

- [ ] API_ENABLED set to 1

---

## Phase 2: Copy SquareLine UI Files (10 minutes)

### 2.1 Copy UI Directory
```bash
cd /Users/ryangoff/Herd/Attend/storage/app/templates/esp32_p4_nfc_espidf

# Remove old basic UI (if it exists)
rm -rf ui/

# Copy SquareLine Studio UI
cp -r ../esp32_p4_lvgl_test/ui ./
```

- [ ] UI directory copied
- [ ] Verify: `ls ui/` shows ui.c, ui.h, ui_events.c, ui_screen_*.c

### 2.2 Copy SquareLine Project (for future edits)
```bash
# Copy SquareLine Studio project
cp -r ../esp32_p4_lvgl_test/SquareLineConsole ./
```

- [ ] SquareLineConsole directory copied
- [ ] Verify: `ls SquareLineConsole/` shows .spj file

### 2.3 Copy Documentation
```bash
# Copy UI documentation
cp -r ../esp32_p4_lvgl_test/docs ./
```

- [ ] Documentation copied
- [ ] Verify: `ls docs/` shows SQUARELINE_WORKFLOW.md, etc.

---

## Phase 3: Update Build Configuration (15 minutes)

### 3.1 Create ui/CMakeLists.txt

Create new file `ui/CMakeLists.txt`:

```cmake
# UI component CMakeLists.txt
idf_component_register(
    SRCS
        "ui.c"
        "ui_events.c"
        "ui_helpers.c"
        "ui_comp.c"
        "ui_comp_backgroundcontainer.c"
        "ui_comp_hook.c"
        "ui_screen_mainscreen.c"
        "ui_screen_adminlogin.c"
        "ui_screen_setupconfigurations.c"
        "ui_screen_wifisetup.c"
        "ui_screen_wiredsetup.c"
        "ui_screen_deviceinformation.c"
        "ui_screen_timeinformation.c"
        "ui_font_Icons.c"
        "ui_font_Icon2.c"
        "ui_img_baseline_wifi_black_36dp_png.c"
    INCLUDE_DIRS "."
    REQUIRES lvgl esp_lvgl_port
)
```

- [ ] `ui/CMakeLists.txt` created

### 3.2 Update Root CMakeLists.txt

Edit `CMakeLists.txt` (root directory):

Find this section:
```cmake
set(EXTRA_COMPONENT_DIRS
    # existing entries
)
```

Add ui directory:
```cmake
set(EXTRA_COMPONENT_DIRS
    "ui"
    # other entries if any
)
```

- [ ] Root CMakeLists.txt updated to include ui directory

---

## Phase 4: Update main.c (20 minutes)

### 4.1 Update Includes

Edit `main/main.c`:

**Replace this:**
```c
#include "ui_manager.h"  // Old basic UI
```

**With this:**
```c
#include "ui.h"          // SquareLine Studio UI
#include "ui_manager.h"  // Keep for helper functions
```

- [ ] Includes updated in main.c

### 4.2 Update UI Initialization

Find the UI initialization section in `app_main()`:

**Replace this (approximate - check your actual code):**
```c
// Old UI initialization
ui_manager_init();
```

**With this:**
```c
// Initialize SquareLine Studio UI
ESP_LOGI(TAG, "Initializing SquareLine Studio UI...");

// Lock LVGL mutex
bsp_display_lock(0);

// Initialize UI
ui_init();

// Unlock LVGL mutex
bsp_display_unlock();

ESP_LOGI(TAG, "UI initialized");
```

- [ ] UI initialization updated in app_main()

---

## Phase 5: Implement ui_events.c (1-2 hours)

### 5.1 Update Includes in ui_events.c

Edit `ui/ui_events.c`:

Replace the minimal generated stub with proper includes:

```c
// This file was generated by SquareLine Studio
// SquareLine Studio version: SquareLine Studio 1.6.0
// LVGL version: 9.2.2
// Project name: SquareLine_TimeClock_Rand

#include "ui.h"
#include "esp_log.h"
#include "bsp/display.h"

// Include existing managers
#include "../main/network_manager.h"
#include "../main/wifi_manager.h"
#include "../main/ethernet_manager.h"
#include "../main/api_client.h"
#include "../main/time_settings.h"
#include "../main/features.h"
#include "nvs_flash.h"
#include "nvs.h"
#include "esp_mac.h"

static const char *TAG = "UI_EVENTS";
```

- [ ] ui_events.c includes updated

### 5.2 Implement Navigation Event Handlers

Add these functions to `ui_events.c`:

```c
// ========== Admin Login ==========
void ui_event_adminlogin_button_okbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code != LV_EVENT_CLICKED) return;

    const char *password = lv_textarea_get_text(ui_adminlogin_textarea_passwordinput);

    if(strcmp(password, DEFAULT_ADMIN_PASSWORD) == 0) {
        ESP_LOGI(TAG, "Admin authenticated");
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_setupconfigurations);
            bsp_display_unlock();
        }
    } else {
        ESP_LOGW(TAG, "Invalid admin password");
        // TODO: Show error message on screen
    }
}

void ui_event_adminlogin_button_cancelbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_mainscreen);
            bsp_display_unlock();
        }
    }
}

void ui_event_adminlogin_textarea_passwordinput(lv_event_t * e)
{
    // Keyboard focus handling - auto-generated
}

void ui_event_adminlogin_keyboard_passwordkeyboard(lv_event_t * e)
{
    // Keyboard event handling - auto-generated
}

// ========== Setup Menu ==========
void ui_event_setupconfigurations_button_wifinetworksettingsbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        ESP_LOGI(TAG, "Opening WiFi settings");
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_wifisetup);
            bsp_display_unlock();
        }
    }
}

void ui_event_setupconfigurations_button_wirednetworksettingsbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        ESP_LOGI(TAG, "Opening Ethernet settings");
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_wiredsetup);
            bsp_display_unlock();
        }
    }
}

void ui_event_setupconfigurations_button_deviceinfobutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        ESP_LOGI(TAG, "Opening device info");
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_deviceinformation);
            bsp_display_unlock();
        }
    }
}

void ui_event_setupconfigurations_button_timeinfobutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        ESP_LOGI(TAG, "Opening time settings");
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_timeinformation);
            bsp_display_unlock();
        }
    }
}

void ui_event_setupconfigurations_button_closebutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        ESP_LOGI(TAG, "Closing setup menu");
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_mainscreen);
            bsp_display_unlock();
        }
    }
}

// ========== Main Screen ==========
void ui_event_mainscreen_button_settingsbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);

    // Require long press to prevent accidental access
    if(code == LV_EVENT_LONG_PRESSED) {
        ESP_LOGI(TAG, "Settings button long-pressed");
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_adminlogin);
            bsp_display_unlock();
        }
    }
}

void ui_event_mainscreen_label_neticonlabel(lv_event_t * e)
{
    // Optional: Show network details on click
}

// ========== WiFi Setup - Cancel/OK ==========
void ui_event_wifisetup_button_cancelbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_setupconfigurations);
            bsp_display_unlock();
        }
    }
}

void ui_event_wifisetup_button_okbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code != LV_EVENT_CLICKED) return;

    // TODO: Implement WiFi connection
    ESP_LOGI(TAG, "WiFi OK button clicked - implement connection logic");
}

// ========== Ethernet Setup - Cancel/OK ==========
void ui_event_wiredsetup_button_cancelbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code == LV_EVENT_CLICKED) {
        if(bsp_display_lock(0)) {
            lv_scr_load(ui_screen_setupconfigurations);
            bsp_display_unlock();
        }
    }
}

void ui_event_wiredsetup_button_okbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code != LV_EVENT_CLICKED) return;

    // TODO: Implement Ethernet configuration
    ESP_LOGI(TAG, "Ethernet OK button clicked - implement config logic");
}

// ========== Stub handlers for keyboard/textarea focus ==========
void ui_event_wifisetup_textarea_ssidinput(lv_event_t * e) { }
void ui_event_wifisetup_textarea_passwordinput(lv_event_t * e) { }
void ui_event_wifisetup_textarea_hostnameinput(lv_event_t * e) { }
void ui_event_wifisetup_textarea_ipaddressinput(lv_event_t * e) { }
void ui_event_wifisetup_textarea_gatewayinput(lv_event_t * e) { }
void ui_event_wifisetup_textarea_netmaskinput(lv_event_t * e) { }
void ui_event_wifisetup_textarea_dnsinput(lv_event_t * e) { }
void ui_event_wifisetup_textarea_dns2input(lv_event_t * e) { }
void ui_event_wifisetup_switch_dhcpswitch(lv_event_t * e) { }
void ui_event_wifisetup_keyboard_networkkeyboard(lv_event_t * e) { }

void ui_event_wiredsetup_textarea_hostnameinput(lv_event_t * e) { }
void ui_event_wiredsetup_textarea_ipaddressinput(lv_event_t * e) { }
void ui_event_wiredsetup_textarea_gatewayinput(lv_event_t * e) { }
void ui_event_wiredsetup_textarea_netmaskinput(lv_event_t * e) { }
void ui_event_wiredsetup_textarea_dnsinput(lv_event_t * e) { }
void ui_event_wiredsetup_textarea_dns2input(lv_event_t * e) { }
void ui_event_wiredsetup_switch_dhcpswitch(lv_event_t * e) { }
void ui_event_wiredsetup_keyboard_networkkeyboard(lv_event_t * e) { }
```

- [ ] Basic navigation event handlers implemented
- [ ] Admin login works (test later)
- [ ] All screens accessible from setup menu

---

## Phase 6: Update ui_manager.c (30 minutes)

### 6.1 Add Helper Functions

Edit `main/ui_manager.c`:

Add these helper functions for updating SquareLine UI:

```c
#include "ui_manager.h"
#include "../ui/ui.h"
#include "bsp/display.h"
#include "esp_log.h"

static const char *TAG = "UI_MANAGER";

void ui_manager_update_time(const char *time_str)
{
    if(bsp_display_lock(0)) {
        lv_label_set_text(ui_mainscreen_label_timelabel, time_str);
        bsp_display_unlock();
    }
}

void ui_manager_update_date(const char *date_str)
{
    if(bsp_display_lock(0)) {
        lv_label_set_text(ui_mainscreen_label_datelabel, date_str);
        bsp_display_unlock();
    }
}

void ui_manager_update_network_status(bool connected)
{
    if(bsp_display_lock(0)) {
        if(connected) {
            lv_label_set_text(ui_mainscreen_label_neticonlabel, LV_SYMBOL_WIFI);
        } else {
            lv_label_set_text(ui_mainscreen_label_neticonlabel, "");
        }
        bsp_display_unlock();
    }
}

void ui_manager_show_message(const char *message, bool is_success)
{
    // TODO: Add message label to main screen first
    ESP_LOGI(TAG, "Message: %s (success=%d)", message, is_success);
}
```

### 6.2 Update ui_manager.h

Edit `main/ui_manager.h`:

Add function declarations:

```c
#ifndef UI_MANAGER_H
#define UI_MANAGER_H

#include <stdbool.h>

// UI update functions
void ui_manager_update_time(const char *time_str);
void ui_manager_update_date(const char *date_str);
void ui_manager_update_network_status(bool connected);
void ui_manager_show_message(const char *message, bool is_success);

#endif // UI_MANAGER_H
```

- [ ] ui_manager.c updated with helper functions
- [ ] ui_manager.h updated with declarations

---

## Phase 7: Build & Test (30 minutes)

### 7.1 Clean Build
```bash
cd /Users/ryangoff/Herd/Attend/storage/app/templates/esp32_p4_nfc_espidf

# Set up ESP-IDF environment
. ~/.espressif/frameworks/esp-idf-v5.5.1/export.sh

# Clean build
idf.py fullclean

# Build
idf.py build
```

- [ ] Build completes without errors
- [ ] No missing symbol errors
- [ ] No undefined reference errors

**Common Build Errors & Fixes:**

‚ùå **Error**: `ui.h: No such file or directory`
‚úÖ **Fix**: Check `ui/CMakeLists.txt` exists and root CMakeLists.txt includes ui directory

‚ùå **Error**: `undefined reference to ui_event_*`
‚úÖ **Fix**: Implement all event handler stubs in ui_events.c

‚ùå **Error**: `multiple definition of ui_Screen_*`
‚úÖ **Fix**: Don't include both old UI and new UI simultaneously

### 7.2 Flash to Device
```bash
# Flash and monitor
idf.py flash monitor
```

- [ ] Firmware flashes successfully
- [ ] Device boots without errors
- [ ] Monitor shows "UI initialized" log

### 7.3 UI Testing

**Test Checklist:**

- [ ] **Display works**: UI appears on 7" screen
- [ ] **Touch works**: Can tap buttons
- [ ] **Main screen visible**: Time, date, machine name display
- [ ] **Settings button**: Long press opens admin login
- [ ] **Admin login**: Password "admin" works, navigates to setup
- [ ] **Setup menu**: All 4 buttons navigate to correct screens
- [ ] **WiFi setup screen**: Opens, keyboard appears on textarea tap
- [ ] **Ethernet setup screen**: Opens, same as WiFi
- [ ] **Device info screen**: Opens (may be empty - OK for now)
- [ ] **Time info screen**: Opens
- [ ] **Cancel buttons**: Return to previous screen
- [ ] **Close setup menu**: Returns to main screen

---

## Phase 8: Connect to Existing Backend (1-2 hours)

### 8.1 Implement WiFi Setup

Edit `ui/ui_events.c`, update `ui_event_wifisetup_button_okbutton`:

```c
void ui_event_wifisetup_button_okbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code != LV_EVENT_CLICKED) return;

    // Get input values
    const char *ssid = lv_textarea_get_text(ui_wifisetup_textarea_ssidinput);
    const char *password = lv_textarea_get_text(ui_wifisetup_textarea_passwordinput);

    // Validate
    if(strlen(ssid) == 0) {
        ESP_LOGW(TAG, "SSID required");
        // TODO: Show error on screen
        return;
    }

    ESP_LOGI(TAG, "Connecting to WiFi: %s", ssid);

    // Show connecting status
    if(bsp_display_lock(0)) {
        lv_label_set_text(ui_wifisetup_label_wifidisconnected, "Connecting...");
        bsp_display_unlock();
    }

    // Call existing wifi_manager
    // You'll need to check your actual wifi_manager API
    // This is an example:
    wifi_manager_connect(ssid, password);

    // wifi_manager should call a callback when connected
    // Update the label in that callback
}
```

- [ ] WiFi setup calls wifi_manager
- [ ] Test WiFi connection works
- [ ] Status updates on screen

### 8.2 Implement Time Sync

Edit `ui/ui_events.c`, find time sync button handler:

```c
void ui_event_timeinformation_button_syncbutton(lv_event_t * e)
{
    lv_event_code_t code = lv_event_get_code(e);
    if(code != LV_EVENT_CLICKED) return;

    ESP_LOGI(TAG, "Syncing time with server");

    // Call existing time_settings module
    time_settings_sync_with_server();

    // Show feedback
    // TODO: Update status label
}
```

- [ ] Time sync calls time_settings module
- [ ] Test time synchronization

### 8.3 Update Time Display Task

Find your time update task in `main/main.c` (or create it):

```c
static void time_update_task(void *pvParameters)
{
    char time_buffer[32];
    char date_buffer[32];

    while(1) {
        time_t now;
        struct tm timeinfo;
        time(&now);
        localtime_r(&now, &timeinfo);

        // Format time
        strftime(time_buffer, sizeof(time_buffer), "%I:%M:%S %p", &timeinfo);
        ui_manager_update_time(time_buffer);

        // Format date
        strftime(date_buffer, sizeof(date_buffer), "%A, %b %d, %Y", &timeinfo);
        ui_manager_update_date(date_buffer);

        vTaskDelay(pdMS_TO_TICKS(1000));  // Update every second
    }
}

// In app_main(), after UI init:
xTaskCreate(time_update_task, "time_update", 4096, NULL, 5, NULL);
```

- [ ] Time updates every second on main screen
- [ ] Date updates on main screen

### 8.4 Connect NFC Reader

Find your NFC callback in `main/nfc_reader.c` (or wherever it is):

```c
// In NFC card detected callback
void on_card_detected(const char *card_uid)
{
    ESP_LOGI(TAG, "Card detected: %s", card_uid);

    // Show message on UI
    ui_manager_show_message("Card detected...", true);

    // Send to API
    api_client_send_punch("nfc", card_uid);
}
```

- [ ] NFC card scan triggers UI update
- [ ] API punch request sent

---

## Phase 9: Final Testing & Polish (1 hour)

### 9.1 Full System Test

**Complete Workflow Test:**

1. [ ] Power on device
2. [ ] Main screen displays
3. [ ] Time/date updating
4. [ ] Network icon shows status
5. [ ] Scan NFC card ‚Üí API punch sent
6. [ ] Long press settings ‚Üí Admin login appears
7. [ ] Enter password ‚Üí Setup menu appears
8. [ ] WiFi setup ‚Üí Connect to network
9. [ ] Time sync ‚Üí Time updates
10. [ ] Device info ‚Üí Shows MAC, IP
11. [ ] All screens accessible and working

### 9.2 Known Issues to Fix Later

**Document these TODOs:**

- [ ] Add employee message panel on main screen (SquareLine edit needed)
- [ ] Implement DHCP toggle show/hide manual IP fields
- [ ] Add error messages for failed WiFi connection
- [ ] Populate device information dynamically
- [ ] Implement Ethernet setup (if using wired)
- [ ] Add status indicators for NFC/WiFi/API

---

## Phase 10: Documentation (30 minutes)

### 10.1 Update README

Edit `esp32_p4_nfc_espidf/README.md`:

Add section about UI:
```markdown
## SquareLine Studio UI

This firmware uses a professional touch screen UI designed in SquareLine Studio.

### UI Screens
- Main Screen: Clock in/out interface
- Admin Login: Password-protected settings access
- Setup Menu: WiFi, Ethernet, Device Info, Time Settings
- WiFi Setup: Configure wireless network
- Ethernet Setup: Configure wired network
- Device Information: Hardware/software details
- Time Settings: NTP sync, timezone configuration

### Modifying the UI
1. Open `SquareLineConsole/SquareLine_TimeClock_Rand.spj`
2. Make changes in SquareLine Studio
3. Export to `ui/` directory
4. Rebuild firmware

See `docs/SQUARELINE_WORKFLOW.md` for details.
```

- [ ] README updated

### 10.2 Document Integration Points

Create `docs/INTEGRATION_POINTS.md`:

```markdown
# Integration Points

## UI ‚Üí Backend Connections

| UI Element | Backend Function | File |
|------------|------------------|------|
| WiFi Setup OK Button | `wifi_manager_connect()` | ui_events.c ‚Üí wifi_manager.c |
| Time Sync Button | `time_settings_sync()` | ui_events.c ‚Üí time_settings.c |
| NFC Card Scan | `api_client_send_punch()` | main.c ‚Üí api_client.c |
| Network Status Icon | `ui_manager_update_network_status()` | wifi_manager.c ‚Üí ui_manager.c |
| Time Display | `ui_manager_update_time()` | main.c ‚Üí ui_manager.c |
```

- [ ] Integration points documented

---

## Success Criteria

‚úÖ **Merge is complete when:**

- [ ] Firmware builds without errors
- [ ] UI displays on 7" screen
- [ ] Touch navigation works (can access all screens)
- [ ] Admin login validates password
- [ ] WiFi setup connects to network
- [ ] Time sync updates system time
- [ ] NFC card detection sends API request
- [ ] Time/date update on main screen
- [ ] All documentation updated

---

## Troubleshooting

### Build Errors

**Missing ui.h**:
```
fatal error: ui.h: No such file or directory
```
‚Üí Check `ui/CMakeLists.txt` exists and root CMakeLists includes ui

**Undefined reference to ui_event_***:
```
undefined reference to `ui_event_wifisetup_button_okbutton'
```
‚Üí Implement stub in ui_events.c (can be empty `{ }` for now)

### Runtime Errors

**Display shows garbage**:
‚Üí Check LVGL color depth matches (should be 16-bit)

**Touch not working**:
‚Üí Verify BSP initialization includes touch controller

**Screen freezes**:
‚Üí Check for deadlocks - always unlock bsp_display_lock()

**UI doesn't update**:
‚Üí Ensure you're calling ui_manager functions from tasks (not ISRs)

---

## Next Steps After Merge

1. **Add employee message panel** to main screen (SquareLine edit)
2. **Implement remaining event handlers** (DHCP toggle, etc.)
3. **Polish UI feedback** (loading spinners, error messages)
4. **Add company branding** (logo, colors)
5. **Test with real users**
6. **Deploy to first customer**

---

## Time Estimate

| Phase | Time |
|-------|------|
| Backup & Prep | 5 min |
| Copy Files | 10 min |
| Build Config | 15 min |
| Update main.c | 20 min |
| Implement ui_events.c | 1-2 hours |
| Update ui_manager | 30 min |
| Build & Test | 30 min |
| Backend Integration | 1-2 hours |
| Testing & Polish | 1 hour |
| Documentation | 30 min |
| **TOTAL** | **4-6 hours** |

---

## Help Resources

- **Build issues**: Check `docs/DEPLOYMENT_GUIDE.md`
- **UI design changes**: See `docs/SQUARELINE_WORKFLOW.md`
- **Event handlers**: Reference `docs/FIRMWARE_INTEGRATION.md`
- **API integration**: Check `docs/API_INTEGRATION.md`

---

**Ready to start?** Begin with Phase 1 (Backup) and work through sequentially. Don't skip phases!

Good luck! üöÄ

<?xml version="1.0" encoding="UTF-8"?>
<!--
ESP32 Time Clock Configuration Template
This file should be stored in SPIFFS/LittleFS on the ESP32 device
File path: /config.xml
-->
<timeclock_config version="1.0">
    <!-- Device Identity -->
    <device>
        <name>{{DEVICE_NAME}}</name>
        <id>{{DEVICE_ID}}</id>
        <mac_address>{{MAC_ADDRESS}}</mac_address>
        <firmware_version>{{FIRMWARE_VERSION}}</firmware_version>
        <type>esp32_timeclock</type>
    </device>

    <!-- Network Configuration -->
    <network>
        <wifi>
            <ssid>{{WIFI_SSID}}</ssid>
            <password>{{WIFI_PASSWORD}}</password>
            <security>WPA2</security>
            <auto_reconnect>true</auto_reconnect>
            <connection_timeout>30</connection_timeout>
        </wifi>
        <ethernet>
            <enabled>false</enabled>
            <dhcp>true</dhcp>
            <static_ip></static_ip>
            <subnet></subnet>
            <gateway></gateway>
            <dns></dns>
        </ethernet>
    </network>

    <!-- Server Configuration -->
    <server>
        <host>{{SERVER_HOST}}</host>
        <port>{{SERVER_PORT}}</port>
        <protocol>https</protocol>
        <api_base_path>/api/v1/timeclock</api_base_path>
        <api_token>{{API_TOKEN}}</api_token>
        <token_expires>{{TOKEN_EXPIRES}}</token_expires>
        <verify_ssl>true</verify_ssl>
        <connection_timeout>10</connection_timeout>
        <sync_interval>{{SYNC_INTERVAL}}</sync_interval>
    </server>

    <!-- Time Synchronization -->
    <time>
        <ntp_server>{{NTP_SERVER}}</ntp_server>
        <timezone>{{TIMEZONE}}</timezone>
        <sync_interval>3600</sync_interval>
        <fallback_servers>
            <server>pool.ntp.org</server>
            <server>time.cloudflare.com</server>
            <server>time.google.com</server>
        </fallback_servers>
    </time>

    <!-- Hardware Configuration -->
    <hardware>
        <!-- NFC/RFID Reader -->
        <nfc>
            <enabled>{{NFC_ENABLED}}</enabled>
            <module_type>MFRC522</module_type>
            <spi_bus>VSPI</spi_bus>
            <pin_cs>5</pin_cs>
            <pin_rst>2</pin_rst>
            <read_timeout>5</read_timeout>
            <retry_attempts>3</retry_attempts>
        </nfc>

        <!-- Status LED -->
        <led>
            <enabled>{{LED_ENABLED}}</enabled>
            <pin_red>18</pin_red>
            <pin_green>19</pin_green>
            <pin_blue>21</pin_blue>
            <brightness>128</brightness>
            <patterns>
                <idle>blue_fade</idle>
                <reading>yellow_solid</reading>
                <success>green_flash</success>
                <error>red_flash</error>
                <network_error>red_fast_blink</network_error>
            </patterns>
        </led>

        <!-- Buzzer/Speaker -->
        <buzzer>
            <enabled>{{BUZZER_ENABLED}}</enabled>
            <pin>22</pin>
            <sounds>
                <card_read>beep_short</card_read>
                <success>beep_double</success>
                <error>beep_long</error>
                <network_error>beep_triple</network_error>
            </sounds>
        </buzzer>

        <!-- Display (Optional) -->
        <display>
            <enabled>false</enabled>
            <type>OLED_128x64</type>
            <i2c_address>0x3C</i2c_address>
            <pin_sda>21</pin_sda>
            <pin_scl>22</pin_scl>
            <show_time>true</show_time>
            <show_ip>true</show_ip>
            <show_status>true</show_status>
        </display>

        <!-- Power Management -->
        <power>
            <sleep_enabled>false</sleep_enabled>
            <sleep_timeout>300</sleep_timeout>
            <wake_on_card>true</wake_on_card>
            <low_power_mode>false</low_power_mode>
        </power>
    </hardware>

    <!-- Operational Settings -->
    <operation>
        <punch_timeout>{{PUNCH_TIMEOUT}}</punch_timeout>
        <offline_storage>{{OFFLINE_STORAGE}}</offline_storage>
        <max_offline_records>1000</max_offline_records>
        <retry_failed_syncs>true</retry_failed_syncs>
        <max_retry_attempts>5</max_retry_attempts>
        <retry_backoff>exponential</retry_backoff>

        <!-- Card/Credential Processing -->
        <card_processing>
            <duplicate_prevention>10</duplicate_prevention>
            <card_formats>
                <format>MIFARE_Classic</format>
                <format>MIFARE_Ultralight</format>
                <format>NTAG213</format>
            </card_formats>
            <read_block>4</read_block>
            <validation>checksum</validation>
        </card_processing>
    </operation>

    <!-- Security Settings -->
    <security>
        <encryption_enabled>true</encryption_enabled>
        <api_token_rotation>true</api_token_rotation>
        <secure_boot>false</secure_boot>
        <certificate_pinning>false</certificate_pinning>
        <debug_enabled>{{DEBUG_ENABLED}}</debug_enabled>
        <log_level>{{LOG_LEVEL}}</log_level>
    </security>

    <!-- Maintenance & Updates -->
    <maintenance>
        <auto_update>false</auto_update>
        <update_check_interval>86400</update_check_interval>
        <maintenance_window>02:00-04:00</maintenance_window>
        <watchdog_enabled>true</watchdog_enabled>
        <watchdog_timeout>30</watchdog_timeout>
        <factory_reset_pin>0</factory_reset_pin>
    </maintenance>

    <!-- Logging & Diagnostics -->
    <logging>
        <enabled>{{LOGGING_ENABLED}}</enabled>
        <level>{{LOG_LEVEL}}</level>
        <local_storage>true</local_storage>
        <max_log_size>1048576</max_log_size>
        <remote_logging>false</remote_logging>
        <syslog_server></syslog_server>
    </logging>
</timeclock_config>